datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  userId      String        @id
  email       String        @unique
  firstName   String
  lastName    String
  userDomains DomainUsers[]
  persons     Person[]

  @@map("users")
}

model Domain {
  domainId    String        @id
  name        String        @unique
  domainUsers DomainUsers[]
  persons     Person[]
  subdomains  Subdomain[]

  @@map("domains")
}

model Person {
  userId String
  user   User   @relation(fields: [userId], references: [userId])

  domainId String
  domain   Domain @relation(fields: [domainId], references: [domainId])

  @@id([userId, domainId])
  @@index([userId])
  @@index([domainId])
  @@map("persons")
}

model DomainUsers {
  userId String
  user   User   @relation(fields: [userId], references: [userId])

  domainId String
  domain   Domain @relation(fields: [domainId], references: [domainId])

  @@id([userId, domainId])
  @@index([userId])
  @@index([domainId])
  @@map("domain_users")
}

model Subdomain {
  subdomainId String @id
  domainId    String
  domain      Domain @relation(fields: [domainId], references: [domainId])
  name        String @unique

  @@map("subdomains")
}
