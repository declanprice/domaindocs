datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

model User {
  userId    String   @id
  email     String   @unique
  firstName String
  lastName  String
  fullName  String
  iconUri   String?  @default("https://ps.w.org/user-avatar-reloaded/assets/icon-256x256.png?rev=2540745")
  people    Person[]
  roles     Role[]
}

model Domain {
  domainId   String      @id
  name       String      @unique
  people     Person[]
  subdomains Subdomain[]
  teams      Team[]
  projects   Project[]
  roles      Role[]
}

model Person {
  personId String @id

  userId String
  user   User   @relation(fields: [userId], references: [userId])

  domainId String
  domain   Domain @relation(fields: [domainId], references: [domainId])

  role Role?

  subdomainContacts SubdomainContact[]
  subdomainPeople   SubdomainPerson[]
  teamPersons       TeamPerson[]
  PersonProject     PersonProject[]

  @@index([userId])
  @@index([domainId])
}

model Role {
  roleId String @id

  userId String
  user   User   @relation(fields: [userId], references: [userId])

  domainId String
  domain   Domain @relation(fields: [domainId], references: [domainId])

  personId String @unique()
  person   Person @relation(fields: [personId], references: [personId])

  name String @default("Employee")

  @@index([userId])
  @@index([domainId])
}

model Subdomain {
  subdomainId            String                  @id
  domainId               String
  domain                 Domain                  @relation(fields: [domainId], references: [domainId])
  name                   String                  @unique
  description            String                  @default("")
  subdomainPeople        SubdomainPerson[]
  subdomainContacts      SubdomainContact[]
  subdomainResourceLinks SubdomainResourceLink[]
  subdomainTeams         SubdomainTeam[]
  subdomainProjects      SubdomainProject[]

  @@index([domainId])
}

model SubdomainPerson {
  personId String
  person   Person @relation(fields: [personId], references: [personId])

  subdomainId String
  subdomains  Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  @@id([personId, subdomainId])
  @@index([personId])
  @@index([subdomainId])
}

model SubdomainContact {
  contactId String @id

  subdomainId String
  subdomain   Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  personId String
  person   Person @relation(fields: [personId], references: [personId])

  @@unique([personId, subdomainId])
  @@index([personId])
  @@index([subdomainId])
}

model SubdomainResourceLink {
  linkId String @id

  subdomainId String
  subdomain   Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  title    String
  subTitle String  @default("Goto Resource")
  href     String
  iconUri  String? @default("https://cdn1.vectorstock.com/i/1000x1000/25/25/resources-allocation-icon-on-white-vector-27442525.jpg")

  @@index([subdomainId])
}

model Team {
  teamId  String  @id
  name    String
  iconUri String? @default("https://cdn-icons-png.flaticon.com/512/1369/1369288.png")

  domainId       String
  domain         Domain          @relation(fields: [domainId], references: [domainId])
  teamPeople     TeamPerson[]
  subdomainTeams SubdomainTeam[]
  teamProjects   TeamProject[]

  @@index([domainId])
}

model TeamPerson {
  teamId String
  team   Team   @relation(fields: [teamId], references: [teamId])

  personId String
  person   Person @relation(fields: [personId], references: [personId])

  @@id([teamId, personId])
  @@index([teamId])
  @@index([personId])
}

model SubdomainTeam {
  teamId String
  team   Team   @relation(fields: [teamId], references: [teamId])

  subdomainId String
  subdomain   Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  @@id([teamId, subdomainId])
  @@index([teamId])
  @@index([subdomainId])
}

model Project {
  projectId String  @id
  name      String
  iconUri   String? @default("https://cdn-icons-png.freepik.com/256/12148/12148631.png")

  domainId          String
  domain            Domain             @relation(fields: [domainId], references: [domainId])
  peopleProjects    PersonProject[]
  teamProjects      TeamProject[]
  subdomainProjects SubdomainProject[]

  @@index([domainId])
}

model PersonProject {
  projectId String
  project   Project @relation(fields: [projectId], references: [projectId])

  personId String
  person   Person @relation(fields: [personId], references: [personId])

  @@id([projectId, personId])
  @@index([projectId])
  @@index([personId])
}

model TeamProject {
  projectId String
  project   Project @relation(fields: [projectId], references: [projectId])

  teamId String
  team   Team   @relation(fields: [teamId], references: [teamId])

  @@id([projectId, teamId])
  @@index([projectId])
  @@index([teamId])
}

model SubdomainProject {
  projectId String
  project   Project @relation(fields: [projectId], references: [projectId])

  subdomainId String
  subdomains  Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  @@id([projectId, subdomainId])
  @@index([projectId])
  @@index([subdomainId])
}
