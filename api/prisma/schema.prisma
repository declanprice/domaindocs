datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  userId            String             @id
  email             String             @unique
  firstName         String
  lastName          String
  iconUri           String?
  domainUsers       DomainUser[]
  subdomainUsers    SubdomainUser[]
  subdomainContacts SubdomainContact[]
  teamUsers         TeamUser[]
  projectsUsers     ProjectUser[]
  domainUserRoles   DomainUserRole[]
}

model Domain {
  domainId        String           @id
  name            String           @unique
  domainUsers     DomainUser[]
  subdomains      Subdomain[]
  subdomainUsers  SubdomainUser[]
  teams           Team[]
  projects        Project[]
  domainUserRoles DomainUserRole[]
}

model DomainUser {
  userId String
  user   User   @relation(fields: [userId], references: [userId])

  domainId String
  domain   Domain @relation(fields: [domainId], references: [domainId])

  domainUserRole DomainUserRole?

  @@id([userId, domainId])
  @@index([userId])
  @@index([domainId])
}

model DomainUserRole {
  userId String
  user   User   @relation(fields: [userId], references: [userId])

  domainId String
  domain   Domain @relation(fields: [domainId], references: [domainId])

  domainUser DomainUser @relation(fields: [userId, domainId], references: [userId, domainId], map: "domain_user_fk")

  name String @default("Employee")

  @@id([userId, domainId])
  @@index([userId])
  @@index([domainId])
}

model Subdomain {
  subdomainId            String                  @id
  domainId               String
  domain                 Domain                  @relation(fields: [domainId], references: [domainId])
  name                   String                  @unique
  description            String                  @default("")
  subdomainUsers         SubdomainUser[]
  subdomainContacts      SubdomainContact[]
  subdomainResourceLinks SubdomainResourceLink[]
  teamSubdomains         TeamSubdomain[]
  projectSubdomains      ProjectSubdomain[]

  @@index([domainId])
}

model SubdomainUser {
  userId String
  user   User   @relation(fields: [userId], references: [userId])

  domainId String
  domain   Domain @relation(fields: [domainId], references: [domainId])

  subdomainId String
  subdomain   Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  @@id([userId, subdomainId])
  @@index([userId])
  @@index([subdomainId])
  @@index([domainId])
}

model SubdomainContact {
  subdomainId String
  subdomain   Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  userId String
  user   User   @relation(fields: [userId], references: [userId])

  @@id([subdomainId, userId])
  @@index([subdomainId])
  @@index([userId])
}

model SubdomainResourceLink {
  linkId String @id

  subdomainId String
  subdomain   Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  title    String
  subTitle String
  href     String
  iconUri  String?

  @@index([subdomainId])
}

model Team {
  teamId  String  @id
  name    String
  iconUri String?

  domainId          String
  domain            Domain             @relation(fields: [domainId], references: [domainId])
  teamUsers         TeamUser[]
  teamSubdomains    TeamSubdomain[]
  projectTeams      ProjectTeam[]
  projectSubdomains ProjectSubdomain[]

  @@index([domainId])
}

model TeamUser {
  teamId String
  team   Team   @relation(fields: [teamId], references: [teamId])

  userId String
  user   User   @relation(fields: [userId], references: [userId])

  role String

  @@id([teamId, userId])
  @@index([teamId])
  @@index([userId])
}

model TeamSubdomain {
  teamId String
  team   Team   @relation(fields: [teamId], references: [teamId])

  subdomainId String
  subdomain   Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  @@id([teamId, subdomainId])
  @@index([teamId])
  @@index([subdomainId])
}

model Project {
  projectId String  @id
  name      String
  iconUri   String?

  domainId     String
  domain       Domain        @relation(fields: [domainId], references: [domainId])
  projectUsers ProjectUser[]
  projectTeams ProjectTeam[]

  @@index([domainId])
}

model ProjectUser {
  projectId String
  project   Project @relation(fields: [projectId], references: [projectId])

  userId String
  user   User   @relation(fields: [userId], references: [userId])

  role String

  @@id([projectId, userId])
  @@index([projectId])
  @@index([userId])
}

model ProjectTeam {
  projectId String
  project   Project @relation(fields: [projectId], references: [projectId])

  teamId String
  team   Team   @relation(fields: [teamId], references: [teamId])

  role String

  @@id([projectId, teamId])
  @@index([projectId])
  @@index([teamId])
}

model ProjectSubdomain {
  teamId String
  team   Team   @relation(fields: [teamId], references: [teamId])

  subdomainId String
  subdomain   Subdomain @relation(fields: [subdomainId], references: [subdomainId])

  @@id([teamId, subdomainId])
  @@index([teamId])
  @@index([subdomainId])
}
